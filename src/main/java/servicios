package servicios;
import dominio.Pago;
import dominio.Pedidos;
import negocio.PersistenciaException;
import java.time.LocalDateTime;
/**
 *
 * @author oscar
 */
public class GestionEntregas {

    public void entregarPedido(Pedidos pedido, String metodoPago) throws Exception {
        
        // Validación de estado
        if (!pedido.getEstadoPedido().equalsIgnoreCase("Listo")) {
            throw new Exception("Error: Solo se pueden entregar pedidos en estado 'Listo'. " +
                                "Estado actual: " + pedido.getEstadoPedido());
        }

        // Cambio de estado y registro de tiempo exacto
        pedido.setEstadoPedido("Entregado");
        pedido.setFechaHoraEntrega(LocalDateTime.now());

        // Asociación obligatoria del registro de pago (Simulación por ahora)
        registrarPago(pedido, metodoPago);
        
        System.out.println("Pedido #" + pedido.getIdPedido() + " entregado exitosamente.");
    }

    private void registrarPago(Pedidos pedido, String metodo) throws PersistenciaException {
    Pago nuevoPago = new Pago(pedido.getIdPedido(), pedido.getTotal(), metodo);
    
    System.out.println("Pago vinculado al pedido #" + pedido.getIdPedido());
}
}
